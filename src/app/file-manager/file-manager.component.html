<mat-toolbar>
	<mat-icon *ngIf="canNavigateUp" class="pointer" (click)="navigateUp()"
		>arrow_back</mat-icon
	>
	<span style="margin-left: 8px">{{ currentPath || 'File manager' }}</span>
	<span class="spacer"></span>
	<button mat-icon-button [matMenuTriggerFor]="appMenu">
		<mat-icon>more_vert</mat-icon>
	</button>
	<mat-menu #appMenu="matMenu">
		<button mat-menu-item (click)="fileInput.click()">
			<mat-icon color="pointer">note_add</mat-icon>
			<span class="inline">Add new file</span>
		</button>
		<button mat-menu-item (click)="openNewFolderDialog()">
			<mat-icon>create_new_folder</mat-icon>
			<span class="inline">Add new folder</span>
		</button>
	</mat-menu>
	<input
		type="file"
		class="hidden"
		#fileInput
		multiple
		(change)="fileChange(fileInput.files)"
	/>
</mat-toolbar>
<div
	fxFlex
	class="container"
	fxLayout="row"
	fxLayoutAlign="space-between stretch"
>
	<div class="content" fxFlex fxLayout="row">
		<mat-grid-list cols="8" rowHeight="100px" fxFlex>
			<mat-grid-tile
				*ngFor="let element of items; let index = index"
				class="file-or-folder"
			>
				<span
					[matMenuTriggerFor]="rootMenu"
					[matMenuTriggerData]="{ element: element, index: index }"
					#menuTrigger="matMenuTrigger"
				></span>
				<div
					fxLayout="column"
					fxLayoutAlign="space-between center"
					(click)="navigate(element)"
					(contextmenu)="openMenu($event, menuTrigger)"
				>
					<mat-icon
						color="primary"
						class="file-or-folder-icon pointer"
						*ngIf="element.folder"
						>folder</mat-icon
					>
					<mat-icon
						color="primary"
						class="file-or-folder-icon pointer"
						*ngIf="!element.folder"
						>insert_drive_file</mat-icon
					>
					<span class="item-name">{{ element.name }}</span>
				</div>
			</mat-grid-tile>
		</mat-grid-list>
	</div>
</div>

<mat-menu #rootMenu="matMenu" [overlapTrigger]="false">
	<ng-template matMenuContent let-element="element" let-index="index">
		<button
			mat-menu-item
			[matMenuTriggerFor]="moveToMenu"
			[matMenuTriggerData]="{ self: element }"
		>
			<mat-icon>open_with</mat-icon>
			<span>Move To</span>
		</button>
		<button
			mat-menu-item
			*ngIf="!element.folder"
			(click)="downloadFile(element)"
		>
			<mat-icon>get_app</mat-icon>
			<span>Download</span>
		</button>
		<button mat-menu-item (click)="openRenameDialog(element, index)">
			<mat-icon>edit</mat-icon>
			<span>Rename</span>
		</button>
		<button mat-menu-item (click)="deleteFile(element.id, index)">
			<mat-icon>delete</mat-icon>
			<span>Delete</span>
		</button>
	</ng-template>
</mat-menu>

<mat-menu #moveToMenu="matMenu">
	<ng-template matMenuContent let-self="self">
		<ng-container *ngFor="let item of items">
			<button
				*ngIf="item.folder && item.id !== self.id"
				mat-menu-item
				(click)="moveElement(self, item)"
			>
				{{ item.name }}
			</button>
		</ng-container>
	</ng-template>
</mat-menu>

<!-- <router-outlet></router-outlet> -->
